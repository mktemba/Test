<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahjong Tile Renderer - Demo & Test Suite</title>
    <link rel="stylesheet" href="src/lib/TileRenderer.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 60px;
        }

        section h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        section h3 {
            font-size: 1.3em;
            margin: 30px 0 15px;
            color: #555;
        }

        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .tile-showcase {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.1s ease;
            font-weight: 500;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h4 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .interactive-demo {
            background: #fff;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
        }

        .demo-info {
            background: #e7f3ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .demo-info.success {
            background: #d1fae5;
            border-left-color: #22c55e;
        }

        .demo-info.error {
            background: #fee2e2;
            border-left-color: #ef4444;
        }

        code {
            background: #f1f3f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        .test-results {
            margin: 20px 0;
        }

        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-item.pass {
            background: #d1fae5;
            border-left: 4px solid #22c55e;
        }

        .test-item.fail {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .test-item .icon {
            font-size: 1.5em;
        }

        footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            section h2 {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Mahjong Tile Renderer</h1>
            <p>SVG-based tile rendering system with accessibility and performance</p>
        </header>

        <div class="content">
            <!-- Introduction -->
            <section id="intro">
                <h2>Overview</h2>
                <div class="description">
                    <p>A comprehensive, production-ready SVG-based Mahjong tile rendering system featuring:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>42 unique, authentic Mahjong tile designs</li>
                        <li>Performance-optimized with caching (&lt;10ms render time)</li>
                        <li>WCAG 2.1 AA accessible with ARIA labels and keyboard navigation</li>
                        <li>Responsive sizing with multiple presets</li>
                        <li>Interactive states (hover, selected, correct, incorrect)</li>
                        <li>Reduced motion and high contrast support</li>
                    </ul>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <h4>Total Tiles</h4>
                        <div class="value" id="totalTiles">42</div>
                    </div>
                    <div class="stat-card">
                        <h4>Cache Size</h4>
                        <div class="value" id="cacheSize">0 KB</div>
                    </div>
                    <div class="stat-card">
                        <h4>Avg Render Time</h4>
                        <div class="value" id="renderTime">0 ms</div>
                    </div>
                </div>
            </section>

            <!-- All Tiles Showcase -->
            <section id="showcase">
                <h2>Complete Tile Set</h2>

                <h3>Bamboo Tiles (1-9)</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="bamboo-tiles"></div>
                </div>

                <h3>Dot Tiles (1-9)</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="dot-tiles"></div>
                </div>

                <h3>Character Tiles (1-9)</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="character-tiles"></div>
                </div>

                <h3>Wind Tiles (East, South, West, North)</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="wind-tiles"></div>
                </div>

                <h3>Dragon Tiles (Red, Green, White)</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="dragon-tiles"></div>
                </div>
            </section>

            <!-- Size Comparison -->
            <section id="sizes">
                <h2>Size Options</h2>
                <div class="description">
                    <p>Four size presets available: Small (40x60), Medium (60x90), Large (80x120), X-Large (100x150)</p>
                </div>

                <div class="tile-showcase">
                    <div class="tile-display">
                        <div id="size-small"></div>
                        <div id="size-medium"></div>
                        <div id="size-large"></div>
                        <div id="size-xlarge"></div>
                    </div>
                </div>
            </section>

            <!-- Interactive States -->
            <section id="states">
                <h2>Interactive States</h2>
                <div class="description">
                    <p>Tiles support multiple visual states for user interaction and feedback.</p>
                </div>

                <h3>Normal</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="state-normal"></div>
                </div>

                <h3>Hover (hover over tiles above)</h3>

                <h3>Selected</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="state-selected"></div>
                </div>

                <h3>Correct</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="state-correct"></div>
                </div>

                <h3>Incorrect</h3>
                <div class="tile-showcase">
                    <div class="tile-display" id="state-incorrect"></div>
                </div>
            </section>

            <!-- Interactive Demo -->
            <section id="interactive">
                <h2>Interactive Demo</h2>
                <div class="interactive-demo">
                    <p style="margin-bottom: 20px; font-weight: 500;">Click on tiles to select them. Try to find matching pairs!</p>

                    <div class="controls">
                        <button onclick="resetGame()">Reset Game</button>
                        <button class="secondary" onclick="toggleReducedMotion()">Toggle Reduced Motion</button>
                    </div>

                    <div class="demo-info" id="gameStatus">
                        Select two tiles to find a match!
                    </div>

                    <div class="tile-hand" id="game-tiles"></div>
                </div>
            </section>

            <!-- Performance Tests -->
            <section id="performance">
                <h2>Performance Tests</h2>
                <div class="description">
                    <p>Automated tests to verify rendering performance and memory efficiency.</p>
                </div>

                <div class="controls">
                    <button onclick="runPerformanceTests()">Run Performance Tests</button>
                    <button class="secondary" onclick="runAccessibilityTests()">Run Accessibility Tests</button>
                </div>

                <div class="test-results" id="test-results"></div>
            </section>

            <!-- Code Examples -->
            <section id="usage">
                <h2>Usage Examples</h2>

                <h3>Basic Usage</h3>
                <pre><code>// Create a renderer
const renderer = new TileRenderer({ size: 'medium', theme: 'classic' });

// Create a single tile
const tile = renderer.createTileElement('bamboo', 5);
document.body.appendChild(tile);

// Render a hand of tiles
const tiles = [
  { type: 'bamboo', value: 1 },
  { type: 'dots', value: 5 },
  { type: 'characters', value: 9 }
];
const container = document.getElementById('hand');
renderer.renderHand(tiles, container);</code></pre>

                <h3>With Interactive Callbacks</h3>
                <pre><code>// Create interactive tile
const tile = renderer.createTileElement('wind', 'east', {
  interactive: true,
  onClick: (e, element) => {
    console.log('Tile clicked!');
    renderer.updateTileState(element, 'selected');
  }
});</code></pre>

                <h3>Performance Optimization</h3>
                <pre><code>// Preload all tiles for faster rendering
renderer.generateAllTiles();

// Check cache size
const cacheSize = renderer.getCacheSize();
console.log(`Cache size: ${(cacheSize / 1024).toFixed(2)} KB`);

// Clear cache if needed
renderer.clearCache();</code></pre>
            </section>
        </div>

        <footer>
            <p><strong>Mahjong Tile Renderer</strong> v1.0.0</p>
            <p>Performance-optimized, accessible, production-ready SVG tile system</p>
        </footer>
    </div>

    <script src="src/lib/TileRenderer.js"></script>
    <script>
        // Initialize renderers
        const rendererMedium = new TileRenderer({ size: 'medium' });
        const rendererSmall = new TileRenderer({ size: 'small' });
        const rendererLarge = new TileRenderer({ size: 'large' });
        const rendererXLarge = new TileRenderer({ size: 'xlarge' });

        // Track performance
        let totalRenderTime = 0;
        let renderCount = 0;

        function measureRender(fn) {
            const start = performance.now();
            fn();
            const end = performance.now();
            const duration = end - start;
            totalRenderTime += duration;
            renderCount++;
            return duration;
        }

        // Render all tile types
        function renderAllTiles() {
            // Bamboo tiles
            const bambooContainer = document.getElementById('bamboo-tiles');
            for (let i = 1; i <= 9; i++) {
                measureRender(() => {
                    rendererMedium.appendTile(bambooContainer, 'bamboo', i, { interactive: false });
                });
            }

            // Dot tiles
            const dotContainer = document.getElementById('dot-tiles');
            for (let i = 1; i <= 9; i++) {
                measureRender(() => {
                    rendererMedium.appendTile(dotContainer, 'dots', i, { interactive: false });
                });
            }

            // Character tiles
            const charContainer = document.getElementById('character-tiles');
            for (let i = 1; i <= 9; i++) {
                measureRender(() => {
                    rendererMedium.appendTile(charContainer, 'characters', i, { interactive: false });
                });
            }

            // Wind tiles
            const windContainer = document.getElementById('wind-tiles');
            ['east', 'south', 'west', 'north'].forEach(dir => {
                measureRender(() => {
                    rendererMedium.appendTile(windContainer, 'wind', dir, { interactive: false });
                });
            });

            // Dragon tiles
            const dragonContainer = document.getElementById('dragon-tiles');
            ['red', 'green', 'white'].forEach(color => {
                measureRender(() => {
                    rendererMedium.appendTile(dragonContainer, 'dragon', color, { interactive: false });
                });
            });

            updateStats();
        }

        // Render size comparison
        function renderSizeComparison() {
            rendererSmall.appendTile(document.getElementById('size-small'), 'bamboo', 5, { interactive: false });
            rendererMedium.appendTile(document.getElementById('size-medium'), 'bamboo', 5, { interactive: false });
            rendererLarge.appendTile(document.getElementById('size-large'), 'bamboo', 5, { interactive: false });
            rendererXLarge.appendTile(document.getElementById('size-xlarge'), 'bamboo', 5, { interactive: false });
        }

        // Render state examples
        function renderStateExamples() {
            const tiles = [
                { type: 'bamboo', value: 3 },
                { type: 'dots', value: 5 },
                { type: 'characters', value: 7 }
            ];

            tiles.forEach(tile => {
                rendererMedium.appendTile(document.getElementById('state-normal'), tile.type, tile.value, { interactive: false });

                const selectedTile = rendererMedium.createTileElement(tile.type, tile.value, { interactive: false });
                selectedTile.classList.add('selected');
                document.getElementById('state-selected').appendChild(selectedTile);

                const correctTile = rendererMedium.createTileElement(tile.type, tile.value, { interactive: false });
                correctTile.classList.add('correct');
                document.getElementById('state-correct').appendChild(correctTile);

                const incorrectTile = rendererMedium.createTileElement(tile.type, tile.value, { interactive: false });
                incorrectTile.classList.add('incorrect');
                document.getElementById('state-incorrect').appendChild(incorrectTile);
            });
        }

        // Interactive game demo
        let selectedTiles = [];
        let matchedPairs = 0;

        function initGame() {
            const gameTiles = [
                { type: 'bamboo', value: 3 },
                { type: 'bamboo', value: 3 },
                { type: 'dots', value: 5 },
                { type: 'dots', value: 5 },
                { type: 'characters', value: 7 },
                { type: 'characters', value: 7 },
                { type: 'wind', value: 'east' },
                { type: 'wind', value: 'east' },
                { type: 'dragon', value: 'red' },
                { type: 'dragon', value: 'red' }
            ];

            // Shuffle tiles
            for (let i = gameTiles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameTiles[i], gameTiles[j]] = [gameTiles[j], gameTiles[i]];
            }

            const container = document.getElementById('game-tiles');
            container.innerHTML = '';
            selectedTiles = [];
            matchedPairs = 0;

            gameTiles.forEach((tile, index) => {
                const element = rendererMedium.createTileElement(tile.type, tile.value, {
                    interactive: true,
                    onClick: (e, el) => handleTileClick(el, tile, index)
                });
                element.dataset.index = index;
                container.appendChild(element);
            });
        }

        function handleTileClick(element, tile, index) {
            if (element.classList.contains('correct') || selectedTiles.length >= 2) {
                return;
            }

            if (selectedTiles.find(t => t.index === index)) {
                // Deselect
                element.classList.remove('selected');
                selectedTiles = selectedTiles.filter(t => t.index !== index);
                updateGameStatus('Select two tiles to find a match!');
                return;
            }

            // Select
            element.classList.add('selected');
            selectedTiles.push({ element, tile, index });

            if (selectedTiles.length === 2) {
                checkMatch();
            } else {
                updateGameStatus('Select one more tile...');
            }
        }

        function checkMatch() {
            const [tile1, tile2] = selectedTiles;

            if (tile1.tile.type === tile2.tile.type && tile1.tile.value === tile2.tile.value) {
                // Match!
                setTimeout(() => {
                    tile1.element.classList.remove('selected');
                    tile1.element.classList.add('correct');
                    tile2.element.classList.remove('selected');
                    tile2.element.classList.add('correct');
                    selectedTiles = [];
                    matchedPairs++;

                    if (matchedPairs === 5) {
                        updateGameStatus('Congratulations! You found all pairs!', 'success');
                    } else {
                        updateGameStatus('Match found! Keep going!', 'success');
                    }
                }, 300);
            } else {
                // No match
                setTimeout(() => {
                    tile1.element.classList.remove('selected');
                    tile1.element.classList.add('incorrect');
                    tile2.element.classList.remove('selected');
                    tile2.element.classList.add('incorrect');

                    setTimeout(() => {
                        tile1.element.classList.remove('incorrect');
                        tile2.element.classList.remove('incorrect');
                        selectedTiles = [];
                        updateGameStatus('Not a match. Try again!', 'error');
                    }, 800);
                }, 300);
            }
        }

        function updateGameStatus(message, type = '') {
            const status = document.getElementById('gameStatus');
            status.textContent = message;
            status.className = 'demo-info' + (type ? ' ' + type : '');
        }

        function resetGame() {
            initGame();
            updateGameStatus('Select two tiles to find a match!');
        }

        function toggleReducedMotion() {
            document.body.classList.toggle('reduced-motion');
        }

        // Performance tests
        function runPerformanceTests() {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '<h3>Running tests...</h3>';

            const tests = [];

            // Test 1: Single tile render time
            const singleStart = performance.now();
            const testTile = rendererMedium.renderTile('bamboo', 5);
            const singleEnd = performance.now();
            const singleTime = singleEnd - singleStart;
            tests.push({
                name: 'Single tile render time < 10ms',
                pass: singleTime < 10,
                value: `${singleTime.toFixed(2)}ms`
            });

            // Test 2: Batch render time
            const batchStart = performance.now();
            const tempDiv = document.createElement('div');
            const tiles = [];
            for (let i = 1; i <= 9; i++) {
                tiles.push({ type: 'bamboo', value: i });
            }
            rendererMedium.renderHand(tiles, tempDiv);
            const batchEnd = performance.now();
            const batchTime = batchEnd - batchStart;
            tests.push({
                name: 'Batch render 9 tiles < 50ms',
                pass: batchTime < 50,
                value: `${batchTime.toFixed(2)}ms`
            });

            // Test 3: Cache size
            rendererMedium.generateAllTiles();
            const cacheSize = rendererMedium.getCacheSize();
            tests.push({
                name: 'Total cache size < 50KB',
                pass: cacheSize < 50000,
                value: `${(cacheSize / 1024).toFixed(2)} KB`
            });

            // Test 4: All tiles generated
            const allTiles = rendererMedium.generateAllTiles();
            const tileCount = Object.values(allTiles).reduce((acc, cat) => acc + Object.keys(cat).length, 0);
            tests.push({
                name: '42 unique tiles generated',
                pass: tileCount === 42,
                value: `${tileCount} tiles`
            });

            displayTestResults(tests);
        }

        function runAccessibilityTests() {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '<h3>Running accessibility tests...</h3>';

            const tests = [];

            // Test 1: ARIA labels
            const testTile = rendererMedium.createTileElement('bamboo', 5);
            tests.push({
                name: 'Tile has aria-label',
                pass: testTile.hasAttribute('aria-label'),
                value: testTile.getAttribute('aria-label') || 'N/A'
            });

            // Test 2: Role attribute
            tests.push({
                name: 'Tile has role="button"',
                pass: testTile.getAttribute('role') === 'button',
                value: testTile.getAttribute('role') || 'N/A'
            });

            // Test 3: Keyboard navigation
            tests.push({
                name: 'Tile is keyboard focusable',
                pass: testTile.getAttribute('tabindex') === '0',
                value: `tabindex="${testTile.getAttribute('tabindex')}"`
            });

            // Test 4: SVG has role
            const svg = testTile.querySelector('svg');
            tests.push({
                name: 'SVG has role="img"',
                pass: svg && svg.getAttribute('role') === 'img',
                value: svg ? svg.getAttribute('role') : 'N/A'
            });

            // Test 5: Reduced motion support
            const hasReducedMotionCSS = Array.from(document.styleSheets).some(sheet => {
                try {
                    return Array.from(sheet.cssRules).some(rule =>
                        rule.cssText && rule.cssText.includes('prefers-reduced-motion')
                    );
                } catch (e) {
                    return false;
                }
            });
            tests.push({
                name: 'Reduced motion CSS present',
                pass: hasReducedMotionCSS,
                value: hasReducedMotionCSS ? 'Present' : 'Missing'
            });

            displayTestResults(tests);
        }

        function displayTestResults(tests) {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '<h3>Test Results</h3>';

            tests.forEach(test => {
                const div = document.createElement('div');
                div.className = `test-item ${test.pass ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <span class="icon">${test.pass ? '✓' : '✗'}</span>
                    <div>
                        <strong>${test.name}</strong>
                        <div style="font-size: 0.9em; opacity: 0.8;">${test.value}</div>
                    </div>
                `;
                resultsContainer.appendChild(div);
            });
        }

        function updateStats() {
            const avgRenderTime = totalRenderTime / renderCount;
            document.getElementById('renderTime').textContent = avgRenderTime.toFixed(2) + ' ms';

            const cacheSize = rendererMedium.getCacheSize();
            document.getElementById('cacheSize').textContent = (cacheSize / 1024).toFixed(2) + ' KB';
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            renderAllTiles();
            renderSizeComparison();
            renderStateExamples();
            initGame();
        });
    </script>
</body>
</html>
